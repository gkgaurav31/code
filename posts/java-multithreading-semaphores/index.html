<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Java Multithreading - Semaphores" /><meta name="author" content="Gaurav Kumar" /><meta property="og:locale" content="en_US" /><meta name="description" content="This following post is based on the Udemy Course: Java Multithreading" /><meta property="og:description" content="This following post is based on the Udemy Course: Java Multithreading" /><link rel="canonical" href="https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" /><meta property="og:url" content="https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" /><meta property="og:site_name" content="Gaurav’s GitHub Page" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-15T19:36:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Java Multithreading - Semaphores" /><meta name="twitter:site" content="@gkgaurav31" /><meta name="twitter:creator" content="@Gaurav Kumar" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Gaurav Kumar"},"dateModified":"2023-07-15T19:36:00+05:30","datePublished":"2023-07-15T19:36:00+05:30","description":"This following post is based on the Udemy Course: Java Multithreading","headline":"Java Multithreading - Semaphores","mainEntityOfPage":{"@type":"WebPage","@id":"https://gkgaurav31.github.io/posts/java-multithreading-semaphores/"},"url":"https://gkgaurav31.github.io/posts/java-multithreading-semaphores/"}</script><title>Java Multithreading - Semaphores | Gaurav's GitHub Page</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://fonts.gstatic.com" /><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials" /><link rel="dns-prefetch" href="https://www.google-analytics.com" /><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://www.googletagmanager.com" /><link rel="preconnect" href="https://cdn.jsdelivr.net" /><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous" /><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js" ></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-BM99475K5Q"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-BM99475K5Q'); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/freak.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Gaurav's GitHub Page</a></div><div class="site-subtitle font-italic">A place to code</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/coffee/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>BUY ME A COFFEE</span> </a><li class="nav-item"> <a href="/gratitude/" class="nav-link"> <i class="fa-fw fas fa-heart ml-xl-3 mr-xl-3 unloaded"></i> <span>THANK YOU!</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/gkgaurav31" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/gkgaurav31" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gkgaurav31','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Java Multithreading - Semaphores</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Java Multithreading - Semaphores</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Gaurav Kumar </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jul 15, 2023, 7:36 PM +0530" prep="on" > Jul 15, 2023 <i class="unloaded">2023-07-15T19:36:00+05:30</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1861 words">10 min</span></div></div><div class="post-content"><p>This following post is based on the Udemy Course: <a href="https://www.udemy.com/course/java-multithreading/learn/lecture/107238#content">Java Multithreading</a></p><hr /><h2 id="semaphores">SEMAPHORES</h2><blockquote><p>A counting semaphore. Conceptually, a semaphore maintains a set of permits. Each acquire() blocks if necessary until a permit is available, and then takes it. Each release() adds a permit, potentially releasing a blocking acquirer. However, no actual permit objects are used; the Semaphore just keeps a count of the number available and acts accordingly. Semaphores are often used to restrict the number of threads than can access some (physical or logical) resource.</p></blockquote><p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/Semaphore.html">Oracle Doc</a></p><p>Suppose you have a database server that can handle a maximum of 10 concurrent connections due to resource limitations. Each connection corresponds to a thread that needs to acquire a permit from the semaphore before using the database.</p><p>In this case, you would initialize a semaphore with a value of 10, indicating the maximum number of connections available. Each thread (database client) would need to acquire a permit from the semaphore using the acquire() method before it can establish a connection and start executing database operations.</p><p>When a thread calls the acquire() method, it tries to acquire a permit from the semaphore. If a permit is available (a database connection is available), the thread takes the permit and proceeds to establish a connection. If all permits are currently acquired (all connections are in use), the thread will be blocked and put into a waiting state until a permit becomes available (a connection is released).</p><p>Once a thread finishes using the database connection, it releases the permit back to the semaphore using the release() method. This indicates that the connection is no longer in use and becomes available for other threads to acquire.</p><p>By using the acquire() and release() methods with the semaphore, you ensure that the number of concurrent database connections does not exceed the server’s capacity. Threads acquire a permit (connection) before accessing the database and release it when they are done, allowing other threads to acquire the permit and use the connection.</p><p>This approach effectively manages access to the limited number of available database connections, preventing overload and ensuring fair utilization of the server’s resources.</p><h2 id="usage">USAGE</h2><p>The following program initializes a semaphore with one permit, which means only one thread can acquire the semaphore at a time. In the main method, the program prints “1” and then checks the number of available permits using semaphore.availablePermits(), which should be 1 initially. Next, the program calls semaphore.acquire(), which tries to acquire the semaphore. Since there is one permit available, the program successfully acquires it, prints “2”, and checks the number of available permits again (which should be 0 now). After that, the program calls semaphore.acquire() again, but this time it will be blocked because there are no permits available. So, the program pauses at this point, and “3” is not printed.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.Semaphore</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
 

 <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
 
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"1"</span><span class="o">);</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Available Permits: "</span> <span class="o">+</span> <span class="n">semaphore</span><span class="o">.</span><span class="na">availablePermits</span><span class="o">());</span>
  
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"2"</span><span class="o">);</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Available Permits: "</span> <span class="o">+</span> <span class="n">semaphore</span><span class="o">.</span><span class="na">availablePermits</span><span class="o">());</span>
  
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"3"</span><span class="o">);</span>
  
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h3 id="thread-dump">THREAD DUMP</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre><td class="rouge-code"><pre>4236:
2023-07-15 20:54:18
Full thread dump OpenJDK 64-Bit Server VM (11.0.15+10-LTS mixed mode):

Threads class SMR info:
_java_thread_list=0x00000283672076e0, length=10, elements={
0x000002833935a800, 0x0000028367140000, 0x000002836716d800, 0x00000283671c0800,
0x00000283671c1800, 0x00000283671c3000, 0x00000283671c8000, 0x00000283671cf000,
0x0000028367202000, 0x000002836736f000
}

"main" #1 prio=5 os_prio=0 cpu=31.25ms elapsed=16.97s tid=0x000002833935a800 nid=0xa9a4 waiting on condition  [0x000000c183bff000]
   java.lang.Thread.State: WAITING (parking)
 at jdk.internal.misc.Unsafe.park(java.base@11.0.15/Native Method)
 - parking to wait for  &lt;0x0000000622260b98&gt; (a java.util.concurrent.Semaphore$NonfairSync)
 at java.util.concurrent.locks.LockSupport.park(java.base@11.0.15/LockSupport.java:194)
 at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(java.base@11.0.15/AbstractQueuedSynchronizer.java:885)
 at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(java.base@11.0.15/AbstractQueuedSynchronizer.java:1039)
 at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(java.base@11.0.15/AbstractQueuedSynchronizer.java:1345)
 at java.util.concurrent.Semaphore.acquire(java.base@11.0.15/Semaphore.java:318)
 at com.threads.App.main(thread101/App.java:25)

"Reference Handler" #2 daemon prio=10 os_prio=2 cpu=0.00ms elapsed=16.94s tid=0x0000028367140000 nid=0xa48 waiting on condition  [0x000000c1842ff000]
   java.lang.Thread.State: RUNNABLE
 at java.lang.ref.Reference.waitForReferencePendingList(java.base@11.0.15/Native Method)
 at java.lang.ref.Reference.processPendingReferences(java.base@11.0.15/Reference.java:241)
 at java.lang.ref.Reference$ReferenceHandler.run(java.base@11.0.15/Reference.java:213)

"Finalizer" #3 daemon prio=8 os_prio=1 cpu=0.00ms elapsed=16.94s tid=0x000002836716d800 nid=0x7ea0 in Object.wait()  [0x000000c1843fe000]
   java.lang.Thread.State: WAITING (on object monitor)
 at java.lang.Object.wait(java.base@11.0.15/Native Method)
 - waiting on &lt;0x0000000622408f98&gt; (a java.lang.ref.ReferenceQueue$Lock)
 at java.lang.ref.ReferenceQueue.remove(java.base@11.0.15/ReferenceQueue.java:155)
 - waiting to re-lock in wait() &lt;0x0000000622408f98&gt; (a java.lang.ref.ReferenceQueue$Lock)
 at java.lang.ref.ReferenceQueue.remove(java.base@11.0.15/ReferenceQueue.java:176)
 at java.lang.ref.Finalizer$FinalizerThread.run(java.base@11.0.15/Finalizer.java:170)

"Signal Dispatcher" #4 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=16.93s tid=0x00000283671c0800 nid=0x9088 runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Attach Listener" #5 daemon prio=5 os_prio=2 cpu=0.00ms elapsed=16.93s tid=0x00000283671c1800 nid=0x89b8 waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Service Thread" #6 daemon prio=9 os_prio=0 cpu=0.00ms elapsed=16.92s tid=0x00000283671c3000 nid=0x8614 runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" #7 daemon prio=9 os_prio=2 cpu=15.63ms elapsed=16.92s tid=0x00000283671c8000 nid=0x9974 waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
   No compile task

"C1 CompilerThread0" #10 daemon prio=9 os_prio=2 cpu=15.63ms elapsed=16.92s tid=0x00000283671cf000 nid=0x9cd8 waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
   No compile task

"Sweeper thread" #11 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=16.92s tid=0x0000028367202000 nid=0x118c runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Common-Cleaner" #12 daemon prio=8 os_prio=1 cpu=0.00ms elapsed=16.89s tid=0x000002836736f000 nid=0x9db0 in Object.wait()  [0x000000c184aff000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
 at java.lang.Object.wait(java.base@11.0.15/Native Method)
 - waiting on &lt;0x0000000622574190&gt; (a java.lang.ref.ReferenceQueue$Lock)
 at java.lang.ref.ReferenceQueue.remove(java.base@11.0.15/ReferenceQueue.java:155)
 - waiting to re-lock in wait() &lt;0x0000000622574190&gt; (a java.lang.ref.ReferenceQueue$Lock)
 at jdk.internal.ref.CleanerImpl.run(java.base@11.0.15/CleanerImpl.java:148)
 at java.lang.Thread.run(java.base@11.0.15/Thread.java:829)
 at jdk.internal.misc.InnocuousThread.run(java.base@11.0.15/InnocuousThread.java:161)

"VM Thread" os_prio=2 cpu=0.00ms elapsed=16.95s tid=0x000002836713d000 nid=0x2de0 runnable  

"GC Thread#0" os_prio=2 cpu=0.00ms elapsed=16.97s tid=0x0000028339371800 nid=0x65a8 runnable  

"G1 Main Marker" os_prio=2 cpu=0.00ms elapsed=16.97s tid=0x00000283393f4800 nid=0x31bc runnable  

"G1 Conc#0" os_prio=2 cpu=0.00ms elapsed=16.97s tid=0x00000283393f7000 nid=0xa9a0 runnable  

"G1 Refine#0" os_prio=2 cpu=0.00ms elapsed=16.96s tid=0x000002836679c800 nid=0x5394 runnable  

"G1 Young RemSet Sampling" os_prio=2 cpu=0.00ms elapsed=16.96s tid=0x000002836679f800 nid=0x7b48 runnable  
"VM Periodic Task Thread" os_prio=2 cpu=0.00ms elapsed=16.84s tid=0x000002836757d800 nid=0x9f64 waiting on condition  

JNI global refs: 8, weak refs: 0
</pre></table></code></div></div><h2 id="without-semaphore">WITHOUT SEMAPHORE</h2><h3 id="appjava">App.java</h3><p>We will make use of a Cached Thread Pool in this example. It creates a thread pool that creates new threads as needed, but will reuse previously constructed threads when they are available. These pools will typically improve the performance of programs that execute many short-lived asynchronous tasks. Calls to execute will reuse previously constructed threads if available. If no existing thread is available, a new thread will be created and added to the pool. Threads that have not been used for sixty seconds are terminated and removed from the cache. Thus, a pool that remains idle for long enough will not consume any resources.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Semaphore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
 
 <span class="kd">static</span> <span class="nc">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  
  <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
  
  <span class="c1">//submit 200 tasks</span>
  <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">200</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
   <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
     <span class="nc">Connection</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">connect</span><span class="o">();</span>
    <span class="o">}</span>
   <span class="o">});</span>
  <span class="o">}</span>
  
  <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">executorService</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">DAYS</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h3 id="connectionjava">Connection.java</h3><p>Connection class is singleton here. In the following code, the number of connections can reach up to 200. In the next example, we will use Semaphore to limit the number of connections.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="c1">//Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Connection</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Connection</span><span class="o">();</span>
 <span class="kd">private</span> <span class="kt">int</span> <span class="n">numberOfConnections</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
 
 <span class="c1">//private constructor so that other classes cannot create an object of Connection</span>
 <span class="kd">private</span> <span class="nf">Connection</span><span class="o">()</span> <span class="o">{</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">numberOfConnections</span><span class="o">++;</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Current number of connections: "</span> <span class="o">+</span> <span class="n">numberOfConnections</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="c1">//do some work</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">numberOfConnections</span><span class="o">--;</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Connection</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">connection</span><span class="o">;</span>
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h2 id="using-semaphore-to-limit-the-connections">USING SEMAPHORE TO LIMIT THE CONNECTIONS</h2><p>The given code represents a Connection class that manages connections to a limited resource (like a database). It uses a special object called a semaphore to control how many connections can be used at the same time. The code ensures that only a maximum of 10 connections can be taken at once. When a thread wants to use a connection, it needs to ask for permission from the semaphore. If there are available connections, the thread can take one and start doing its work. If all connections are already taken, the thread has to wait until a connection becomes available. Once a thread finishes using a connection, it releases it, allowing other threads to use it. The code also takes care of handling any exceptions that might occur during the connection process. Overall, the code ensures that the number of connections doesn’t exceed the allowed limit and that different threads can use the connections fairly.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Semaphore</span><span class="o">;</span>

<span class="c1">//Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Connection</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Connection</span><span class="o">();</span>
 <span class="kd">private</span> <span class="kt">int</span> <span class="n">numberOfConnections</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
 
 <span class="cm">/*
    limit connections to 10
    true means whichever thread gets first in the waiting pool (queue)
    waiting to acquire a resource, is first to obtain the permit.

    Note that I called it a pool!
    The reason is when you say "Queue", you're saying that things are
    scheduled to be FIFO (First In First Out) .. which is not always the case
    here!
    When you initialize the semaphore with Fairness, by setting its second
    argument to true, it will treat the waiting threads like FIFO.
    But,
    it doesn't have to be that way if you don't set on the fairness. the JVM
    may schedule the waiting threads in some other manner that it sees best
    (See the Java specifications for that).
 */</span>
 
 <span class="kd">private</span> <span class="nc">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
 
 <span class="c1">//private constructor so that other classes cannot create an object of Connection</span>
 <span class="kd">private</span> <span class="nf">Connection</span><span class="o">()</span> <span class="o">{</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">doConnect</span><span class="o">();</span> <span class="c1">//By using try with finally, we are making sure that release() is called even when there is any exception while calling doConnect()</span>
  <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
   <span class="n">semaphore</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doConnect</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//atomic</span>
   <span class="n">numberOfConnections</span><span class="o">++;</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Current number of connections: "</span> <span class="o">+</span> <span class="n">numberOfConnections</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="c1">//do some work</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Working on connections "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
   <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="k">new</span> <span class="nc">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2000</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//atomic</span>
   <span class="n">numberOfConnections</span><span class="o">--;</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I'm done "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" Connection is released , connection count: "</span> <span class="o">+</span> <span class="n">numberOfConnections</span><span class="o">);</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Connection</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">connection</span><span class="o">;</span>
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/multithreading/'>multithreading</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/multithreading/" class="post-tag no-text-decoration" >multithreading</a> <a href="/tags/theory/" class="post-tag no-text-decoration" >theory</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Java Multithreading - Semaphores - Gaurav's GitHub Page&url=https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Java Multithreading - Semaphores - Gaurav's GitHub Page&u=https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Java Multithreading - Semaphores - Gaurav's GitHub Page&url=https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://gkgaurav31.github.io/posts/java-multithreading-semaphores/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/amount-of-time-for-binary-tree-to-be-infected/">Amount of Time for Binary Tree to Be Infected</a><li><a href="/posts/cross-site-scripting-xss/">Cross-Site Scripting (XSS)</a><li><a href="/posts/find-the-celebrity/">Find the Celebrity</a><li><a href="/posts/find-the-element-that-appears-once-in-sorted-array/">Find the element that appears once in sorted array (geeksforgeeks - SDE Sheet)</a><li><a href="/posts/find-all-pairs-with-a-given-sum-geeksforgeeks-sde-sheet/">Find all pairs with a given sum (geeksforgeeks - SDE Sheet)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/geeksforgeeks/">geeksforgeeks</a> <a class="post-tag" href="/tags/important/">important</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/sde-sheet/">sde-sheet</a> <a class="post-tag" href="/tags/arrays/">arrays</a> <a class="post-tag" href="/tags/neetcode150/">neetcode150</a> <a class="post-tag" href="/tags/binarytree/">binarytree</a> <a class="post-tag" href="/tags/dynamic-programming/">dynamic_programming</a> <a class="post-tag" href="/tags/interviewbit/">interviewbit</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/java-multithreading-starting-java-threads/"><div class="card-body"> <span class="timeago small" > Jul 2, 2023 <i class="unloaded">2023-07-02T23:51:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - Starting Java Threads</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading We can create threads either by extending the Thread class or by implementing the Runnable interface. Here is an example of ...</p></div></div></a></div><div class="card"> <a href="/posts/java-multithreading-basic-thread-synchronization/"><div class="card-body"> <span class="timeago small" > Jul 3, 2023 <i class="unloaded">2023-07-03T20:39:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - Basic Thread Synchronization</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading When data is shared between multiple threads, a common issue arises with data caching. In the following example, there is a ...</p></div></div></a></div><div class="card"> <a href="/posts/java-multithreading-the-synchronized-keyword/"><div class="card-body"> <span class="timeago small" > Jul 4, 2023 <i class="unloaded">2023-07-04T20:35:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - The Synchronized Keyword</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading In the following code, the result of sysout(count) will be 0. This is because, even though we have started the two threads t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java-multithreading-deadlock/" class="btn btn-outline-primary" prompt="Older"><p>Java Multithreading - Deadlock</p></a> <a href="/posts/java-multithreading-callable-and-future/" class="btn btn-outline-primary" prompt="Newer"><p>Java Multithreading - Callable and Future</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/gkgaurav31">Gaurav Kumar</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/geeksforgeeks/">geeksforgeeks</a> <a class="post-tag" href="/tags/important/">important</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/sde-sheet/">sde sheet</a> <a class="post-tag" href="/tags/arrays/">arrays</a> <a class="post-tag" href="/tags/neetcode150/">neetcode150</a> <a class="post-tag" href="/tags/binarytree/">binarytree</a> <a class="post-tag" href="/tags/dynamic-programming/">dynamic_programming</a> <a class="post-tag" href="/tags/interviewbit/">interviewbit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://gkgaurav31.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
