<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Java Multithreading - Re-entrant Locks" /><meta name="author" content="Gaurav Kumar" /><meta property="og:locale" content="en_US" /><meta name="description" content="This following post is based on the Udemy Course: Java Multithreading" /><meta property="og:description" content="This following post is based on the Udemy Course: Java Multithreading" /><link rel="canonical" href="https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" /><meta property="og:url" content="https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" /><meta property="og:site_name" content="Gauravâ€™s GitHub Page" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-13T20:22:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Java Multithreading - Re-entrant Locks" /><meta name="twitter:site" content="@gkgaurav31" /><meta name="twitter:creator" content="@Gaurav Kumar" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Gaurav Kumar"},"dateModified":"2023-07-13T20:22:00+05:30","datePublished":"2023-07-13T20:22:00+05:30","description":"This following post is based on the Udemy Course: Java Multithreading","headline":"Java Multithreading - Re-entrant Locks","mainEntityOfPage":{"@type":"WebPage","@id":"https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/"},"url":"https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/"}</script><title>Java Multithreading - Re-entrant Locks | Gaurav's GitHub Page</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://fonts.gstatic.com" /><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials" /><link rel="dns-prefetch" href="https://www.google-analytics.com" /><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous" /><link rel="dns-prefetch" href="https://www.googletagmanager.com" /><link rel="preconnect" href="https://cdn.jsdelivr.net" /><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous" /><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js" ></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-BM99475K5Q"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-BM99475K5Q'); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/freak.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Gaurav's GitHub Page</a></div><div class="site-subtitle font-italic">A place to code</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/coffee/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>BUY ME A COFFEE</span> </a><li class="nav-item"> <a href="/gratitude/" class="nav-link"> <i class="fa-fw fas fa-heart ml-xl-3 mr-xl-3 unloaded"></i> <span>THANK YOU!</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/gkgaurav31" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/gkgaurav31" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gkgaurav31','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Java Multithreading - Re-entrant Locks</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Java Multithreading - Re-entrant Locks</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Gaurav Kumar </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 13, 2023, 8:22 PM +0530" prep="on" > Jul 13, 2023 <i class="unloaded">2023-07-13T20:22:00+05:30</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="945 words">5 min</span></div></div><div class="post-content"><p>This following post is based on the Udemy Course: <a href="https://www.udemy.com/course/java-multithreading/learn/lecture/107238#content">Java Multithreading</a></p><hr /><h2 id="using-reentrant-lock-the-wrong-way">USING REENTRANT LOCK: THE WRONG WAY</h2><h3 id="appjava">App.java</h3><p>We create two threads which will run the firstThread() and secondThread() methods of the Runner class. They will call the increment method to increase the value of count 1000 times. So, the expected total is 2000. This would give us the correct output. However, this approach is not recommended because the code after calling <code class="language-plaintext highlighter-rouge">reentrantLock.lock();</code> could lead to an exception, in which case the lock will never be release and the app will be stuck.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
  
  <span class="nc">Runner</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runner</span><span class="o">();</span>
  
  <span class="nc">Thread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
   
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">runner</span><span class="o">.</span><span class="na">firstThread</span><span class="o">();</span>
   <span class="o">}</span>
  <span class="o">});</span>
  
  <span class="nc">Thread</span> <span class="n">t2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
   
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">runner</span><span class="o">.</span><span class="na">secondThread</span><span class="o">();</span>
   <span class="o">}</span>
  <span class="o">});</span>
  
  <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="n">t2</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  
  <span class="n">t1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
  <span class="n">t2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
  
  <span class="n">runner</span><span class="o">.</span><span class="na">finished</span><span class="o">();</span>
  
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h3 id="runnerjava">Runner.java</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Runner</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
 <span class="kd">private</span> <span class="nc">Lock</span> <span class="n">reentrantLock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
   <span class="n">count</span><span class="o">++;</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">firstThread</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
  <span class="n">increment</span><span class="o">();</span> <span class="c1">//problematic: if increment fails for some reason, the lock will never be released</span>
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">secondThread</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
  <span class="n">increment</span><span class="o">();</span> <span class="c1">//problematic: if increment fails for some reason, the lock will never be released</span>
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finished</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Value of count: "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h2 id="using-reentrant-lock-better-way">USING REENTRANT LOCK: BETTER WAY</h2><p>Finally block will always execute, regardless of whether an exception is caught or not. This behavior ensures that any necessary cleanup or resource release operations are performed, regardless of the programâ€™s flow.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Code that may throw an exception</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Exception handling code</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="c1">// Code that will always run</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Runner</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
 <span class="kd">private</span> <span class="nc">Lock</span> <span class="n">reentrantLock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
   <span class="n">count</span><span class="o">++;</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">firstThread</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>

  <span class="k">try</span> <span class="o">{</span>
   <span class="n">increment</span><span class="o">();</span>  
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">secondThread</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>

  <span class="k">try</span> <span class="o">{</span>
   <span class="n">increment</span><span class="o">();</span>  
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finished</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Value of count: "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div><h2 id="await-and-signal-with-reentrant-lock">AWAIT AND SIGNAL WITH REENTRANT LOCK</h2><p>This behaves similar to wait() and notify() methods. These are part of the Condition class. We can get the object of the corresponding condition class using <code class="language-plaintext highlighter-rouge">reentrantLock.newCondition();</code>. To call await() and signal() method, we can use this object. For example: <code class="language-plaintext highlighter-rouge">condition.await();</code>, <code class="language-plaintext highlighter-rouge">condition.signal();</code>. The behavior is similar to wait() and notify().</p><blockquote><p>Condition factors out the Object monitormethods (wait, notifyand notifyAll) into distinct objects togive the effect of having multiple wait-sets per object, by combining them with the use of arbitrary Lock implementations. Where a Lock replaces the use of synchronized methodsand statements, a Condition replaces the use of the Object monitor methods.</p></blockquote><p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/locks/Condition.html">Oracle Doc</a></p><h3 id="await">await()</h3><p>Causes the current thread to wait until it is signalled or interrupted. Before this method can return the current thread must re-acquire the lock associated with this condition. When the thread returns it is guaranteed to hold this lock.</p><h3 id="signal">signal()</h3><p>Wakes up one waiting thread. If any threads are waiting on this condition then one is selected for waking up. That thread must then re-acquire the lock before returning from await.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.threads</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Condition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.Lock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.locks.ReentrantLock</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Runner</span> <span class="o">{</span>

 <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
 <span class="kd">private</span> <span class="nc">Lock</span> <span class="n">reentrantLock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
 
 <span class="kd">private</span> <span class="nc">Condition</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">reentrantLock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
  
  <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
   <span class="n">count</span><span class="o">++;</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">firstThread</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
  
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
  
  <span class="c1">//we can only call this after we get the lock obviously</span>
  <span class="c1">//once called, it will give up the lock and wait for a signal to continue (it works similar to the wait() method)</span>
  <span class="n">condition</span><span class="o">.</span><span class="na">await</span><span class="o">();</span> 
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Thread 1: Woken up."</span><span class="o">);</span>

  <span class="c1">//this will be executed only after the previous thread has completed the unlock</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">increment</span><span class="o">();</span>  
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">secondThread</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
  
  <span class="c1">//adding sleep to ensure that firstThread get the lock first</span>
  <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span> 
  
  <span class="c1">//get the lock once the first thread calls await</span>
  <span class="n">reentrantLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Press the return key to continue."</span><span class="o">);</span>
  <span class="k">new</span> <span class="nf">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">).</span><span class="na">nextLine</span><span class="o">();</span>
  
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Got the return key."</span><span class="o">);</span>
  
  <span class="n">condition</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>

  <span class="k">try</span> <span class="o">{</span>
   <span class="n">increment</span><span class="o">();</span>  
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="c1">//if we remove this, firstThead will never get executed. Although we have signalled it, however, we have not released the lock</span>
   <span class="n">reentrantLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
  <span class="o">}</span>
  
 <span class="o">}</span>
 
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finished</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Value of count: "</span> <span class="o">+</span> <span class="n">count</span><span class="o">);</span>
 <span class="o">}</span>
 
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/multithreading/'>multithreading</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/multithreading/" class="post-tag no-text-decoration" >multithreading</a> <a href="/tags/theory/" class="post-tag no-text-decoration" >theory</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Java Multithreading - Re-entrant Locks - Gaurav's GitHub Page&url=https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Java Multithreading - Re-entrant Locks - Gaurav's GitHub Page&u=https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Java Multithreading - Re-entrant Locks - Gaurav's GitHub Page&url=https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://gkgaurav31.github.io/posts/java-multithreading-re-entrant-locks/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/amount-of-time-for-binary-tree-to-be-infected/">Amount of Time for Binary Tree to Be Infected</a><li><a href="/posts/cross-site-scripting-xss/">Cross-Site Scripting (XSS)</a><li><a href="/posts/find-the-celebrity/">Find the Celebrity</a><li><a href="/posts/find-the-element-that-appears-once-in-sorted-array/">Find the element that appears once in sorted array (geeksforgeeks - SDE Sheet)</a><li><a href="/posts/find-all-pairs-with-a-given-sum-geeksforgeeks-sde-sheet/">Find all pairs with a given sum (geeksforgeeks - SDE Sheet)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/geeksforgeeks/">geeksforgeeks</a> <a class="post-tag" href="/tags/important/">important</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/sde-sheet/">sde-sheet</a> <a class="post-tag" href="/tags/arrays/">arrays</a> <a class="post-tag" href="/tags/neetcode150/">neetcode150</a> <a class="post-tag" href="/tags/binarytree/">binarytree</a> <a class="post-tag" href="/tags/dynamic-programming/">dynamic_programming</a> <a class="post-tag" href="/tags/interviewbit/">interviewbit</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/java-multithreading-starting-java-threads/"><div class="card-body"> <span class="timeago small" > Jul 2, 2023 <i class="unloaded">2023-07-02T23:51:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - Starting Java Threads</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading We can create threads either by extending the Thread class or by implementing the Runnable interface. Here is an example of ...</p></div></div></a></div><div class="card"> <a href="/posts/java-multithreading-basic-thread-synchronization/"><div class="card-body"> <span class="timeago small" > Jul 3, 2023 <i class="unloaded">2023-07-03T20:39:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - Basic Thread Synchronization</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading When data is shared between multiple threads, a common issue arises with data caching. In the following example, there is a ...</p></div></div></a></div><div class="card"> <a href="/posts/java-multithreading-the-synchronized-keyword/"><div class="card-body"> <span class="timeago small" > Jul 4, 2023 <i class="unloaded">2023-07-04T20:35:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java Multithreading - The Synchronized Keyword</h3><div class="text-muted small"><p> This following post is based on the Udemy Course: Java Multithreading In the following code, the result of sysout(count) will be 0. This is because, even though we have started the two threads t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java-multithreading-producer-consumer-using-low-level-synchronization/" class="btn btn-outline-primary" prompt="Older"><p>Java Multithreading - Producer/Consumer (Using Low-Level Synchronization)</p></a> <a href="/posts/design-pattern-factory/" class="btn btn-outline-primary" prompt="Newer"><p>Design Pattern: Factory</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://twitter.com/gkgaurav31">Gaurav Kumar</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/geeksforgeeks/">geeksforgeeks</a> <a class="post-tag" href="/tags/important/">important</a> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/sde-sheet/">sde sheet</a> <a class="post-tag" href="/tags/arrays/">arrays</a> <a class="post-tag" href="/tags/neetcode150/">neetcode150</a> <a class="post-tag" href="/tags/binarytree/">binarytree</a> <a class="post-tag" href="/tags/dynamic-programming/">dynamic_programming</a> <a class="post-tag" href="/tags/interviewbit/">interviewbit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://gkgaurav31.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
